本周阅读**Database-System-Concepts-7th-Edition**:PART TWO DATABASE DESIGN,知识点总结如下：  
**Chapter 6 Database Design Using the E-R Model**  （p241-p300）  
>日期：3.25
**一、统一建模语言（UML）**  
1. 概述  
UML 是由对象管理组织（OMG）开发的标准，用于创建软件系统各组件的规范。实体 - 关系图有助于对软件系统的数据表示部分进行建模，但数据表示只是系统设计的一部分，UML 涵盖更广泛，包括用户与系统交互、功能模块规范及其交互等方面。
2. 组成部分
类图（Class diagram）
与 E - R 图类似，不仅能描述属性，还能描述方法（对象提供的可调用函数 ）。例如在 Java 中定义一个简单的 Customer 类：  
```  
public class Customer {    
        private String name; 
        private int age;  
    public String getName() {   
        return name;  
    }  
    public void setName(String name) {  
        this.name = name;  
    }  
    protected void internalMethod() {   
    }  
}
```
UML 不支持复合或多值属性，派生属性等同于无参数方法。类支持封装，属性和方法可用 “+”（公共）、“-”（私有）、“#”（受保护）前缀表示访问权限。  
**用例图（Use case diagram）**：展示用户与系统的交互，特别是用户执行任务（如取钱、课程注册 ）的步骤 。例如在银行系统中，取钱的用例可描述为：用户 -> 插入银行卡 -> 输入密码 -> 选择取款金额 -> 取钱 -> 取卡。  
**活动图（Activity diagram）**：描绘系统各组件之间的任务流 。以电商订单处理流程为例：订单创建 -> 库存检查 -> 支付处理 -> 订单发货 -> 订单完成。  
**实现图（Implementation diagram）**：展示系统组件及其在软件和硬件层面的互连情况 。例如在一个 Web 应用中，软件层面有前端页面代码、后端服务器代码，硬件层面有服务器硬件设备，实现图会展示它们之间的连接和交互方式。  
3. 与 E - R 图对比
UML 对关系集的表示与 E - R 图有相似也有不同之处。UML 从 1.3 版开始支持非二元关系，使用与 E - R 图相同的菱形表示法，但多数设计师对二元关系更倾向于用连线表示；基数约束在 UML 中的表示形式与 E - R 图类似，但位置相反 。  
UML 也支持泛化，符号表示与 E - R 图基本相同。此外，UML 类图中带小实心菱形的连线表示 “组合” 关系，类似于 E - R 图中弱实体集对标识实体集的存在依赖关系；小空心菱形表示 “聚合” 关系 。UML 类图还提供表示面向对象语言特性（如接口 ）的符号 。例如在 Java 中定义一个接口 Payment 及实现类 CreditCardPayment：  
```
interface Payment {  
    void pay(double amount);  
}  
class CreditCardPayment implements Payment {  
    @Override  
    public void pay(double amount) {  
        // 实现支付逻辑  
    }  
}     
```
>日期：3.27
**二、数据库设计相关概念**  
1. 实体 - 关系（E - R）模型基础  
实体：现实世界中可区分的对象，通过一组属性来描述。例如 “学生” 实体，可具有属性 student_id（学生编号）、name（姓名）、age（年龄）等。  
关系集：相同类型关系的集合，实体集是相同类型实体的集合。比如 “学生 - 课程” 关系集，体现学生与课程之间的关联。  
键相关概念：  
·超键：能唯一标识实体集或关系集中每个实例的属性集合，可能包含多余属性。例如在 “员工” 实体集中，{employee_id, name} 能唯一标识每个员工，可作为超键。  
·候选键：最小的超键，去掉其中任何属性就不能唯一标识实例，一个实体集或关系集可能有多个候选键。例如在 “员工” 实体集中，若 employee_id 能唯一标识员工，且去掉 employee_id 后其他属性组合都不能唯一标识，那么 {employee_id} 就是候选键 。  
·主键：从候选键中选定的一个用于唯一标识实体集或关系集实例的属性集合，一个实体集或关系集只有一个主键。例如在 “员工” 实体集中，选定 employee_id 作为主键。  
映射基数（Mapping cardinality）：表达一个实体通过关系集能与另一个实体关联的数量，包括一对一、一对多、多对一、多对多关系 。在 SQL 中创建表来体现多对一关系（以 “学生 - 课程” 为例，一个课程对应多个学生 ）：  
```
CREATE TABLE Course (  
    course_id INT PRIMARY KEY,  
    course_name VARCHAR(255)  
);  
CREATE TABLE Student (  
    student_id INT PRIMARY KEY,  
    student_name VARCHAR(255),  
    course_id INT,  
    FOREIGN KEY (course_id) REFERENCES Course(course_id)  
);
```
参与约束  
·完全参与：实体集中每个实体都必须参与到关系集中。例如在 “学生 - 选课” 关系中，若规定每个学生都必须选课，可在 SQL 中通过 NOT NULL 约束实现：  
```
-- 假设 Student 表中有选课字段 course_id
ALTER TABLE Student
MODIFY course_id INT NOT NULL;
```
·部分参与：实体集中部分实体参与到关系集中。比如有些学生可能未选课，此时选课字段 course_id 可以为 NULL。  
弱实体集与强实体集  
·强实体集：具有能唯一标识自身每个实例的主键属性，可独立存在。如 “客户” 实体集，通过 customer_id 唯一标识。  
·弱实体集：没有足够属性形成主键，依赖标识实体集确定唯一性，若标识实体集不存在，弱实体集也失去意义。例如 “订单详情” 依赖 “订单” 实体集，“订单详情” 为弱实体集。  
2. E - R 图设计要点  
·避免冗余：同一实体集多次出现且属性重复会带来数据不一致风险、增加模型冗余和混乱，提高设计和维护成本。比如 “员工” 实体在 E - R 图中多处出现且属性重复，更新时易出现部分更新、部分未更新的情况。  
·图结构含义  
不连通图：表示企业不同部分在数据模型中无直接关联，可能反映业务分离或设计缺陷。例如一个企业的财务部门和销售部门在 E - R 图中不连通，可能意味着数据无法整合分析。  
有环图：说明实体集之间存在循环依赖关系，可能增加数据操作复杂性，需检查合理性并调整。比如在 “供应商 - 零件 - 产品” 关系中若出现环，数据更新和查询会更复杂。  
3. 数据库设计其他方面  
功能需求：企业规定应用程序功能，包括数据更新事务和查询，设计师需规划功能及支持功能的接口，同时要重视授权机制，可在数据库或更高级功能 / 接口层面进行授权 。在 SQL 中创建用户并授权示例：  
```
-- 创建用户
CREATE USER 'user1'@'localhost' IDENTIFIED BY 'password';
-- 授予查询权限
GRANT SELECT ON database_name.* TO 'user1'@'localhost';
```
数据流与工作流：数据库应用常是大型企业应用一部分，工作流是数据和任务组合，在用户间流转并与数据库交互，工作流操作及自身相关数据可能存储在数据库中，设计需考虑。例如在一个报销工作流中，员工提交报销申请 -> 上级审批 -> 财务审核，每个步骤相关数据（如申请金额、审批意见等 ）可能存储在数据库中。  
模式演变：数据库设计非一次性活动，组织需求演变会使数据库模式需更改，好的设计应预见需求，区分基本和可变约束，减少因需求变化带来的修改。例如企业最初只记录员工基本信息，后续因业务需要增加员工绩效信息，数据库模式就需相应调整。   
>日期：3.29
**三、相关练习题涉及知识点及总结**  
1. E - R 图绘制与转换  
绘制：根据不同场景（如汽车保险公司、医院、在线书店扩展等 ）构建 E - R 图，确定实体集（如客户、汽车、患者、医生等 ）、关系集（如拥有、治疗等 ）及其属性。以汽车保险公司为例，实体集 Customer 有属性 customer_id、name 等，Car 有属性 car_id、make 等，关系集 owns 表示客户与汽车的拥有关系。  
转换：将 E - R 图转换为关系模式，确定各关系模式的主键和外键，保证数据完整性和一致性。例如将上述汽车保险公司 E - R 图转换为关系模式：  
```
CREATE TABLE Customer (
    customer_id INT PRIMARY KEY,
    name VARCHAR(255),
    -- 其他属性
);

CREATE TABLE Car (
    car_id INT PRIMARY KEY,
    make VARCHAR(255),
    customer_id INT,
    FOREIGN KEY (customer_id) REFERENCES Customer(customer_id)
);
```
2. 实体集属性处理  
当不同实体集有同名属性时，若属性不相关应重命名；若属性表示相同性质，根据不同情况（如是否为主键等 ）调整设计，可移除、合并实体集或建立关联关系等。比如实体集 A 和 B 都有属性 X，若两者不相关，将其重命名为 A_X 和 B_X；若表示相同性质且 X 是 A 的主键但不是 B 的主键，可在 B 中创建外键引用 A 中的 X。  
3. 关系表示与约束  
探讨三元关系用二元关系表示的不同方式及优缺点，理解不同表示在数据结构和操作上的差异。例如在 “供应商 - 零件 - 产品” 三元关系中，用二元关系表示时不同方式会影响数据查询和更新的复杂度。  
明确不相交（disjoint）和重叠（overlapping）约束、完全（total）和部分（partial）约束的区别，在设计中正确应用这些约束来准确表达实体间关系。比如在 “员工 - 全职员工 - 兼职员工” 关系中，若规定全职员工和兼职员工不相交（disjoint），则一个员工不能既是全职又是兼职；若存在重叠（overlapping），则可能有员工同时具备两种身份。完全参与约束要求每个员工都必须属于全职或兼职类别，部分参与约束则允许存在未明确分类的员工。  
