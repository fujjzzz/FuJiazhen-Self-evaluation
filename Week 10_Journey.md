本周阅读**Database-System-Concepts-7th-Edition**:PART FOUR BIG DATA ANALYTICS,知识点总结如下：  
**Chapter 11 Data Analytics**(p519-555)  
>日期：4.29

### 11.1 Analytics概述
- **数据来源与数据仓库**：大型公司数据来源多样且存储模式各异，出于性能和组织控制考虑，数据源通常不允许随意检索数据。因此组织将数据从多个来源收集到一个地方，即数据仓库。数据仓库以统一模式收集数据，提供单一统一的数据接口。
- **ETL任务**：包括数据提取（extract）、转换（transform）和加载（load）。数据源可能存在错误，且不同来源数据可能有重复，ETL任务负责处理这些问题。
- **分析基本形式**
    - **生成聚合和报告**：分析师获取不同聚合数据并比较以理解数据模式，聚合数据常以图表形式展示。仪表盘是监控组织状况的常用方式。
    - **在线分析处理（OLAP）系统**：能实时处理大型数据聚合查询，支持高效分析。
    - **统计分析**：重要的数据分析部分，工具如R语言、SPSS等 ，R语言有大量包实现多种数据分析任务，还可与数据库集成。
- **预测**：分析的关键方面，如银行决定是否放贷、在线广告商决定展示广告、制造商和零售商决定生产或订购商品，通过分析过去数据预测未来辅助决策。
- **相关术语**
    - **商业智能（BI）**：与数据分析含义相近。
    - **决策支持**：侧重报告和聚合，不包括机器学习/数据挖掘 ，通常使用SQL查询处理大量数据。

### 11.2 数据仓库
- **数据仓库需求**：大型组织内部结构复杂，数据分散、模式不同，且数据源可能仅存储当前数据，决策制定者需要访问多源数据及历史数据，数据仓库解决了这些问题。
- **数据仓库定义**：是从多个来源收集信息的存储库，以统一模式存储在单个站点，长期存储数据，提供单一整合的数据接口，且不影响在线事务处理系统。
- **数据仓库组件相关问题**
    - **数据收集时间和方式**
        - **源驱动架构**：数据源持续或定期传输新信息。
        - **目标驱动架构**：数据仓库定期向数据源请求新数据 。同步复制成本高，很多数据仓库不采用，使用较旧数据进行查询。
    - **模式选择**：独立构建的数据源模式和数据模型可能不同，数据仓库需进行模式集成并转换数据。
    - **数据转换和清理**
        - **数据清理**：纠正和预处理数据，处理如拼写错误、地址不一致等问题，近似匹配称为模糊查找。
        - **去重（deduplication）**：消除多个来源地址列表中的重复项。
        - **分组（householding）**：将一个家庭中多人记录分组。
        - **数据转换**：如更改度量单位、连接多源数据转换模式等，数据仓库通常有图形工具支持数据转换。
    - **更新传播**：数据源关系更新需传播到数据仓库，若仓库关系与数据源相同，传播简单；否则是视图维护问题。
    - **数据汇总**：事务处理系统生成的原始数据可能过大，可通过聚合存储汇总数据，如存储按商品名称和类别划分的服装总销售额，而非每笔销售数据。

### 11.2.2 多维数据与仓库模式
- **事实表和维度表**：数据仓库模式中的关系通常分为事实表和维度表。事实表记录如销售等单个事件信息，规模通常很大。事实表属性分为维度属性和度量属性 。度量属性存储可聚合的定量信息，如销售表中的销售数量和价格；维度属性是度量属性及汇总的分组和查看维度，如销售表中的商品标识符、销售日期、销售地点、购买客户等。
- **多维数据**：能用维度属性和度量属性建模的数据称为多维数据。为减少存储需求，维度属性常作为外键指向维度表。
- **模式类型**
    - **星型模式（star schema）**：由一个事实表、多个维度表以及从事实表到维度表的外键组成。
    - **雪花模式（snowflake schemas）**：更复杂的数据仓库设计，维度表可能有多层，如item_info表可能有指向制造商详细信息表的外键manufacturer_id 。复杂设计也可能有多个事实表。

### 11.2.3 数据仓库的数据库支持
- **与事务处理数据库的区别**：事务处理数据库需支持许多小查询，可能涉及读写操作；数据仓库查询数量少，但每个查询访问大量数据。数据仓库中新记录插入后，旧记录一般不更新，无需并发控制开销，而事务处理数据库中并发控制会带来时间和存储方面的开销。
- **存储方式**
    - **行式存储（row-oriented storage）**：传统方式，将元组所有属性存储在一起，元组按顺序存储在文件中。
    - **列式存储（column-oriented storage）**：关系的每个属性存储在单独文件中。优点是查询少量属性时无需读取其他属性，节省缓存空间和内存带宽；相同类型值存储一起提高压缩效果，减少磁盘存储成本和数据检索时间。缺点是存储或获取单个元组需多次I/O操作。列式存储在数据仓库应用中广泛使用 ，而事务处理应用较少使用。专门为数据仓库设计的数据库实现包括Teradata、Sybase IQ、Amazon Redshift 等，许多传统数据库通过添加列式存储等功能支持数据仓库应用，如Oracle、SAP HANA、Microsoft SQL Server、IBM DB2 。
- **大数据系统**：2010年代，用于处理文件存储数据查询的大数据系统快速发展，成为数据仓库基础设施关键部分。如Apache Hadoop，Hive系统可在Hadoop上执行SQL查询 。许多公司提供优化Hive查询处理的软件，Apache Spark也是支持对文件存储数据进行SQL查询的流行大数据系统。包含列记录的压缩文件结构（如Orc和Parquet ）越来越多地用于存储日志记录，简化与SQL的集成。

### 11.2.4 数据湖
数据仓库注重确保统一数据模式方便查询，而数据湖是可存储多种格式（包括结构化记录和非结构化文件格式）数据的存储库。与数据仓库不同，数据湖无需预先对数据进行预处理，但创建查询时需更多精力，查询工具也需更灵活。Apache Hadoop和Apache Spark是查询此类数据的常用工具，支持对非结构化和结构化数据的查询。

### 11.3.1 多维数据上的聚合
数据分析常需按特定方式分组数据值找模式。以商店分析服装受欢迎程度为例，假设关系 `sales (item_name, color, clothes_size, quantity)` ，`item_name` 取值如 `(skirt, dress, shirt, pants)` ，`color` 取值如 `(dark, pastel, white)` ，`clothes_size` 取值如 `(small, medium, large)` ，`quantity` 表示对应组合的商品总数 。`quantity` 是度量属性，`item_name`、`color`、`clothes_size` 是维度属性。分析多维数据时，管理者可能希望按特定方式展示数据，如查看 `item_name` 和 `color` 不同组合的总数量，将 `clothes_size` 设为 `all` 表示对所有尺寸汇总 。
- **ETL和ELT任务**：将数据导入数据仓库的步骤称为提取（extract）、转换（transform）和加载（load）或ETL任务 。在支持用户定义函数或MapReduce框架的现代数据仓库中，可能先提取、加载数据再转换，称为提取（extract）、加载（load）和转换（transform）或ELT任务 ，ELT方法允许使用并行处理框架进行数据转换。

### 11.3.1 多维数据上的聚合
- **交叉表（cross - tabulation/cross - tab/pivot - table）**：从关系（如 `R` ）派生的表，一个属性（如 `A` ）的值构成列标题，另一个属性（如 `B` ）的值构成行标题。单元格值根据关系中对应元组确定，若对应元组唯一，单元格值来自该元组；若不唯一，通过聚合得到。例如在销售关系中，以 `item_name` 为行标题，`color` 为列标题构建交叉表，单元格值是对应组合的销售数量汇总 。多数交叉表有汇总行和列。
- **数据立方体（data cube）**：将二维交叉表扩展到 `n` 维，可视为 `n` 维立方体。如销售关系的数据立方体有 `item_name`、`color`、`clothes_size` 三个维度，度量属性是 `quantity` 。每个单元格由这三个维度的值标识并包含一个值，维度值可以是 `all`，表示对该维度所有值的汇总。数据立方体中分组聚合方式数量可能很多，如三维数据立方体（3 种颜色、4 种商品、3 种尺寸 ）有 `3×4×3 = 36` 个单元格，加上汇总值，构成 `4×5×4` 的立方体，共 80 个值。对于 `n` 维表，可对 `2^n` 个子集进行分组聚合。
- **OLAP操作**
    - **旋转（pivoting）**：在OLAP系统中，分析师通过交互选择交叉表中的属性来查看同一数据的不同交叉表，改变交叉表中使用维度的操作。
    - **切片（slicing）/切块（dicing）**：切片是固定数据立方体中某个维度的值（如 `clothes_size` 为 `large` ），查看特定维度值下其他维度组合的数据，可看作查看数据立方体的一个切片；当固定多个维度值时称为切块 。
    - **上卷（rollup）**：通过聚合从细粒度数据移动到粗粒度数据的操作。例如从销售关系数据立方体按 `clothes_size` 上卷得到交叉表。
    - **下钻（drill down）**：与上卷相反，从粗粒度数据移动到细粒度数据的操作。细粒度数据需从原始数据或更细粒度汇总数据生成。
    - **层次结构（hierarchy）**：分析师可能希望从不同详细程度查看维度，属性不同详细程度的级别可组织成层次结构。如 `datetime` 属性的时间层次结构（从年、季度、月、日期到小时等 ）和位置层次结构（从地区、国家、州到城市 ）。在服装销售例子中，`clothes` 可按类别（如男装、女装 ）分组，类别在层次结构中高于 `item_name` 。分析师可在层次结构不同级别查看数据，如先查看女装和男装级别汇总，再下钻查看具体商品值，或从详细级别上钻查看更粗粒度汇总 ，这些级别可在同一交叉表显示。 

### 11.3.2 交叉表的关系表示
交叉表与数据库中通常存储的关系表不同，其列数取决于实际数据，数据值变化可能导致添加列，不利于数据存储，但交叉表视图便于向用户展示。无汇总值的交叉表可直接用固定列数的关系形式表示；有汇总行/列的交叉表可引入特殊值 `all` 表示小计（SQL标准用 `null` 值，为避免混淆此处用 `all` ）。例如，通过对销售关系按 `item_name` 分组聚合得到 `color` 和 `clothes_size` 维度值为 `all` 的元组 ；按 `color`、`clothes_size` 分组聚合得到 `item_name` 维度值为 `all` 的元组；不指定属性分组聚合（SQL中可省略 ）得到 `item_name`、`color` 和 `clothes_size` 维度值都为 `all` 的元组 。层次结构也可用关系表示，如服装类别与商品关系 `itemcategory (item_name, category)` ，与销售关系连接后聚合可得到带层次结构的交叉表；城市层次结构可用单个关系 `city_hierarchy (ID, city, state, country, region)` 或多个关系表示，假设城市有唯一标识符 `ID` 避免同名城市混淆 。

### 11.3.3 SQL中的OLAP
使用OLAP系统的分析师需要交互式生成多个聚合结果，且无需等待数分钟或数小时，这促使专门的OLAP系统发展。如今许多数据库系统通过SQL结构实现OLAP功能来表达OLAP查询，如Microsoft等的SQL实现 。   
### 11.3.3 SQL中的OLAP
- **SQL实现OLAP操作**
    - **`group by`扩展**：SQL支持`group by`结构的扩展来执行`cube`和`rollup`操作 。仅使用基本的`group by`子句生成数据立方体需要编写多个独立的SQL查询并使用`union`操作合并，而`cube`和`rollup`结构允许在单个查询中运行多个`group by`查询，并以类似关系的形式返回结果。
    - **`cube`操作**：以零售商店销售关系`sales (item_name, color, clothes_size, quantity)`为例，要生成整个数据立方体，使用单个`group by`查询需要为八种不同的分组属性集编写单独查询 。而`cube`结构允许在一个查询中完成，示例查询如下：
```sql
select item_name, color, clothes_size, sum(quantity)
from sales
group by cube(item_name, color, clothes_size);
```
该查询生成的关系模式为`(item_name, color, clothes_size, sum(quantity))` ，结果中未在特定分组中出现的属性值为`null` ，如按`clothes_size`分组生成的元组模式为`(clothes_size, sum(quantity))` ，转换为完整模式时`item_name`和`color`的值为`null` 。数据立方体关系通常很大，如上述示例可能生成80个元组 。还可使用`grouping`函数区分OLAP操作生成的`null`和数据库中实际存储或外连接产生的`null` ，并通过`case`表达式将OLAP生成的`null`替换为`all` ，示例查询如下：
```sql
select case when grouping(item_name) = 1 then 'all'
            else item_name end as item_name,
       case when grouping(color) = 1 then 'all'
            else color end as color,
       'all' as clothes_size, sum(quantity) as quantity
from sales
group by cube(item_name, color);
```
    - **`rollup`操作**：`rollup`结构与`cube`结构类似，但生成的`group by`查询更少 。例如`group by cube (item_name, color, clothes_size)`会生成八种分组方式，而`group by rollup(item_name, color, clothes_size)`仅生成四种分组方式：`{(item_name, color, clothes_size), (item_name, color), (item_name), ()}` 。属性在`rollup`中的顺序很重要，最后一个属性（如`clothes_size` ）仅出现在一种分组中，倒数第二个属性出现在两种分组中，依此类推，第一个属性除了空分组外出现在所有分组中 。`rollup`操作在层次结构分析中很实用，例如位置层次结构（地区、国家、州、城市 ），可按顺序进行分组下钻操作查看更详细信息 。也可在单个`group by`子句中使用多个`rollup`和`cube` ，如：
```sql
select item_name, color, clothes_size, sum(quantity)
from sales
group by rollup(item_name), rollup(color, clothes_size);
```
此查询生成的分组为`{(item_name, color, clothes_size), (item_name, color), (item_name), (color, clothes_size), (color), ()}` 。如果想要指定特定的分组，可使用`grouping sets`结构，例如：
```sql
select item_name, color, clothes_size, sum(quantity)
from sales
group by grouping sets ((color, clothes_size), (clothes_size, item_name));
```
    - **`pivot`操作**：SQL Server和Oracle支持`pivot`子句创建交叉表 。对于销售关系，示例查询如下：
```sql
select *
from sales
pivot (
    sum(quantity)
    for color in ('dark','pastel','white')
)
order by item_name;
```
`pivot`子句中的`for`子句指定在结果中作为属性名出现的`color`值，`color`属性本身不出现在结果中，其他属性保留，新创建属性的值来自`quantity`属性 。如果有多个元组为给定单元格贡献值，`pivot`子句中的聚合操作指定值的合并方式（如上述示例中`quantity`值求和 ）。`pivot`子句本身不计算交叉表中的小计，可先使用`cube`操作生成关系表示，再应用`pivot`子句得到等效结果，此时`for`子句中需列出`all`值，且`order by`子句需修改 。   
>日期：5.1

### 11.3.4 报告和可视化工具
- **报告生成器**：报告生成器是从数据库生成人类可读摘要报告的工具，它将数据库查询与格式化文本和摘要图表（如条形图或饼图 ）的创建集成在一起 。应用程序开发人员可使用报告生成器的格式化功能指定报告格式，使用变量存储参数（如月份和年份 ）并在报告中定义字段 ，表格、图表、条形图等图形可通过对数据库的查询定义，查询定义可使用变量中存储的参数值 。定义报告结构后可存储并随时执行生成报告 。报告生成器系统提供多种功能来构建表格输出，如定义表格和列标题、显示表格中每个组的小计、自动将长表格拆分为多页并在每页末尾显示小计 。报告生成工具供应商众多，如SAP Crystal Reports和Microsoft（SQL Server Reporting Services） ，一些应用程序套件（如Microsoft Office ）提供将数据库查询结果直接嵌入文档的方法 。
- **图表生成与数据可视化**：Crystal Reports或Excel等电子表格提供的图表生成功能可用于从数据库访问数据，并使用图表或图形生成数据的表格或图形描述，这些图表可嵌入文本文档 。图表最初根据对数据库执行查询生成的数据创建，必要时可重新执行查询并重新生成图表以生成报告的当前版本 。数据可视化技术（即数据的图形表示 ）对于数据分析非常重要，数据可视化系统帮助用户检查大量数据并直观检测模式 。数据的可视化显示（如地图、图表和其他图形表示 ）可向用户紧凑呈现数据，单个图形屏幕可编码比大量文本屏幕更多的信息 。例如，在疾病相关性分析中，可在地图上用特殊颜色（如红色 ）编码患者位置，用户可快速发现问题发生位置并基于数据库定量验证假设；还可将数值信息编码为颜色，使用二维像素矩阵检测项目对之间的关联，购买两种项目的交易百分比可通过像素颜色强度编码，高关联项目在屏幕上显示为明亮像素 。  

### 11.4 数据挖掘
数据挖掘是分析大型数据库以寻找有用模式的过程，它是数据库知识发现（KDD）的一部分，与传统机器学习和统计学的不同在于处理大量主要存储在磁盘上的数据。从数据库发现的知识可由规则或模型表示，通常数据挖掘包含数据预处理和模式后处理的手动环节，是半自动化过程，这里主要关注自动化部分。

### 11.4.1 数据挖掘任务类型
- **预测（prediction）**：数据挖掘最广泛的应用之一，如信用卡公司根据申请人年龄、收入、债务和还款历史等已知属性，预测其信用风险，决定是否发放信用卡；还包括预测哪些客户可能转向竞争对手、哪些人可能响应促销邮件、哪些电话通话可能存在欺诈等。
- **关联（associations）**：寻找相关联的事物，如在线书店根据顾客购买的书推荐相关书籍，相机购买后推荐相关配件；还可发现因果关系，如发现新药与心脏问题的意外关联导致药物退市。关联属于描述性模式，聚类（clusters）也是描述性模式的例子，如通过发现伤寒病例聚集在某口井周围，进而发现井水被污染传播伤寒，疾病聚类检测至今仍重要。 

### 11.4.2 分类
分类问题是在已知物品属于几个类别之一，且有过去物品实例（训练实例）及其所属类别的情况下，预测新物品所属类别，需依据实例的其他属性进行预测。
- **决策树分类器（Decision-Tree Classifiers）**：是广泛使用的分类技术，使用树结构，每个叶节点关联一个类别，每个内部节点关联一个谓词（或更一般地，一个函数）。以信用卡信用风险分类为例，用教育程度（最高学历）和收入两个属性构建决策树，分类时从根节点开始遍历树，在内部节点根据谓词评估数据实例决定走向哪个子节点，直至到达叶节点，叶节点关联的类别即为预测类别。例如，某人学历为硕士，收入40K，从根节点沿“masters”边，再沿“25K to 75K”边到达叶节点，预测其信用风险为“good”。有多种从给定训练集构建决策树分类器的技术。
- **贝叶斯分类器（Bayesian Classifiers）**：先找出训练数据中每个类别的属性值分布，给定新实例`d`，使用该分布信息，依据贝叶斯定理估计实例`d`属于每个类`c_j`的概率`p(c_j|d)` ，概率最大的类为预测类。贝叶斯定理公式为：
```math
p(c_j|d) = \frac{p(d|c_j)p(c_j)}{p(d)}
```
其中`p(d|c_j)`是给定类`c_j`生成实例`d`的概率，`p(c_j)`是类`c_j`出现的概率，`p(d)`是实例`d`出现的概率（因对所有类相同可忽略）。例如，仅用收入属性分类，某人收入76,000，假设收入值分区间，在优秀类中收入在(75,000, 80,000)的概率为0.1，在良好类中为0.05，且优秀类占比0.1，良好类占比0.3，则优秀类的`p(d|c_j)p(c_j)`为0.01，良好类为0.015，该人应归为良好类。一般情况下，精确计算`p(d|c_j)`困难，朴素贝叶斯分类器（naive Bayesian classifiers）假设属性独立分布，通过如下公式估计：
```math
p(d|c_j) = p(d_1|c_j) * p(d_2|c_j) * \cdots * p(d_n|c_j)
```
即实例`d`出现的概率是在类`c_j`下`d`的每个属性值`d_i`出现概率的乘积，`p(d_i|c_j)`从每个类`c_j`中属性`i`的值分布计算，通常用直方图近似。
- **支持向量机分类器（Support Vector Machine Classifiers）** ：在多种应用中分类准确率很高。从几何角度理解，以二维平面上点的分类为例，已知一些点属于类`A`（用`X`标记），一些点属于类`B`（用`O`标记），给定这些点的训练集构建分类器。若能在平面画一条线使类`A`的点在一侧，类`B`的点在另一侧，支持向量机分类器选择与两类中最近点（来自训练数据集）距离最大的线（最大间隔线，maximum margin line ），根据新点在该线哪侧将其分类为`A`或`B`类，图11.12中粗线为最大间隔线，虚线为其他可能的线。

### 11.4.2 分类（续）
- **神经网络分类器（Neural Network Classifiers）**：使用训练数据训练人工神经网络。神经网络由多层“神经元”组成，每层神经元与前一层神经元相连。输入实例进入第一层，每层神经元根据前一层输入应用某个函数“激活” ，该函数计算输入神经元激活值的加权组合并生成输出，一层神经元的激活会影响下一层神经元的激活。最终输出层通常每个类别对应一个神经元，给定输入下激活值最大的神经元决定该输入的预测类别。神经网络成功的关键是上述计算中使用的权重，这些权重基于训练数据学习得到，初始设为默认值，然后用训练数据学习权重。训练通常是将每个输入应用于神经网络当前状态并检查预测是否正确，若不正确，使用反向传播算法调整网络中神经元的权重，使预测更接近当前输入的正确结果，重复此过程得到训练好的神经网络，用于新输入的分类。近年来，神经网络在图像识别、语音识别和自然语言翻译等过去认为很难的任务中取得很大成功，例如根据动物图像识别物种（如猫或狗 ）等分类问题。深度神经网络（Deep neural networks）是具有大量层的神经网络，在有大量训练实例时在这类任务中表现出色，深度学习（deep learning）指创建此类深度神经网络并在大量训练实例上进行训练的机器学习技术。

### 11.4.3 回归（Regression）
回归处理的是值的预测，而非类别预测。给定一组变量$X_1, X_2, \ldots, X_n$的值，希望预测变量$Y$的值。例如，将教育程度和收入视为数值，基于这两个变量预测违约可能性（可以是违约的百分比概率或违约涉及的金额 ）。一种方法是推断系数$a_0, a_1, a_2, \ldots, a_n$，使得：
```math
Y = a_0 + a_1 * X_1 + a_2 * X_2 + \cdots + a_n * X_n
```
找到这样的线性多项式称为线性回归（linear regression），一般希望找到一条拟合数据的曲线（由多项式或其他公式定义），该过程也称为曲线拟合（curve fitting）。由于数据中的噪声或关系并非精确多项式，拟合可能只是近似的，回归旨在找到能给出最佳拟合的系数，统计学中有标准技术来寻找回归系数。 

### 11.4.4 关联规则（Association Rules）
零售商店常关注人们购买的不同物品之间的关联，例如“买面包的人很可能也买牛奶”“买《数据库系统概念》这本书的人很可能也买《操作系统概念》这本书” 。关联信息有多种用途，如在线商店根据顾客购买的书推荐相关书籍，杂货店将面包和牛奶放在一起方便顾客购买，或放在一排的两端并在中间放置其他关联物品吸引顾客购买更多商品，还可用于决定促销策略。关联规则的示例为：`bread ⇒ milk` ，在杂货店购买场景中，该规则表示买面包的顾客很可能也买牛奶。关联规则必须有相关总体（population），总体由一组实例（instances）组成，在杂货店例子中，总体可以是所有杂货店购买记录，每个购买记录是一个实例；在书店例子中，总体可以是所有进行购买的人，每个顾客是一个实例。规则有关联的支持度（support）和置信度（confidence） ：
- **支持度**：衡量总体中同时满足规则前件和后件的比例。例如，假设所有购买记录中只有0.001% 包含牛奶和螺丝刀，那么规则`milk ⇒ screwdrivers` 的支持度很低，这样的规则可能在统计上不显著，企业通常对低支持度规则不感兴趣；若50% 的购买记录涉及牛奶和面包，那么涉及面包和牛奶（且无其他物品 ）的规则支持度相对较高，可能值得关注，具体认为可接受的最低支持度取决于应用场景。 
- **置信度**：衡量当前件为真时后件为真的频率。例如，规则`bread ⇒ milk` 若80% 包含面包的购买记录也包含牛奶，则其置信度为80% ，低置信度的规则无意义，商业应用中规则的置信度通常远低于100% ，而在物理等其他领域，规则可能有高置信度，注意`bread ⇒ milk` 和`milk ⇒ bread` 的置信度可能差别很大，尽管它们有相同的支持度。 

### 11.4.5 聚类（Clustering）
聚类直观上是在给定数据中寻找点的簇。聚类问题可从距离度量角度用多种方式形式化，一种方式是将点分组为$k$个集合（对于给定的$k$ ），使点到其所属簇质心的平均距离最小化；另一种是使每个簇内点之间的平均距离最小化。所有这些定义的本质是将相似的点聚集在一个集合中。聚类在生物学分类系统中也有应用（这类分类系统不预测类别，而是将相关物品聚类 ），例如豹子和人类聚类在哺乳纲，鳄鱼和蛇聚类在爬行纲，哺乳纲和爬行纲都属于脊索动物门，哺乳纲还有食肉目和灵长目等子簇，即层次聚类（hierarchical clustering），生物学家根据不同物种的特征创建了复杂的层次聚类方案，在层次结构的不同级别将相关物种分组。统计学领域对聚类进行了广泛研究，数据库研究提供了可扩展的聚类算法，能对可能无法装入内存的大型数据集进行聚类。聚类的一个有趣应用是基于以下因素预测一个人可能对哪些新电影（或书籍、音乐 ）感兴趣：
1. 此人过去对电影的偏好。
2. 有相似过去偏好的其他人。 
3. 这些人对新电影的偏好。 

一种解决此问题的方法是：根据人们对电影的偏好创建人群簇，通过先根据电影相似度对电影进行聚类可提高聚类准确性，这样即使人们没看过相同电影，但看过相似电影也会被聚类在一起。可以交替对人、电影、人等进行聚类，直到达到平衡。对于新用户，根据其对已看过电影的偏好找到与其最相似的用户簇，然后预测该用户簇喜欢的电影簇中的电影可能会让新用户感兴趣，这是协同过滤（collaborative filtering）的一个实例，即用户在过滤信息以找到感兴趣信息的任务中进行协作。 

### 11.4.6 文本挖掘（Text Mining）
文本挖掘将数据挖掘技术应用于文本文件，有多种任务：
- **情感分析（sentiment analysis）**：例如公司想了解用户对新产品的反应，网上通常有大量产品评论，人工阅读每条评论不现实，公司可分析评论以找出对产品评论的情感倾向（正面、负面或中性 ），特定词语如“excellent”“good”“awesome”“beautiful”等与正面情感相关，“awful”“average”“worthless”“poor quality”等与负面情感相关，情感分析技术可用于分析评论并得出反映评论总体情感的分数。
- **信息提取（information extraction）**：从非结构化文本描述或文档中数据的表格显示等半结构化数据创建结构化信息，该过程的一个关键子任务是实体识别（entity recognition），即识别文本中提及的实体并消除歧义。例如文章中提到“Michael Jordan” ，有著名篮球运动员和机器学习专家两个同名人物，消除歧义（disambiguation）是根据文章上下文确定具体指哪一个，在体育文章中提到“Michael Jordan” 可能指篮球运动员，在机器学习论文中提到可能指教授。实体识别后，其他技术可用于学习实体的属性以及实体之间的关系。信息提取可用于分析客户支持对话或社交媒体上的评论，判断客户满意度，决定何时需要干预以留住客户；服务提供商可了解评论是关于服务的价格、质量、卫生或服务人员行为等哪方面，还可提取服务地点等属性，对采取纠正措施很重要。从网络上大量文档和其他来源提取的信息可表示为知识图谱（knowledge graph），网络搜索引擎使用知识图谱为用户查询生成更有意义的答案。

### 11.4 数据挖掘（总结）
- **分类（Classification）**：依据训练实例的属性和实际类别，通过测试实例的属性来预测其类别。常见分类器有：
    - **决策树分类器（Decision - tree classifiers）**：基于训练实例构建树，叶节点带有类别标签进行分类。
    - **贝叶斯分类器（Bayesian classifiers）**：基于概率论进行分类。
    - **支持向量机（Support vector machine）**：是广泛使用的分类技术。
    - **神经网络（Neural networks）** ：特别是深度学习，在视觉、语音识别、语言理解和翻译等相关分类任务中非常成功。
- **关联规则（Association rules）**：识别频繁共现的物品，如倾向于被同一顾客购买的物品，相关性则寻找与预期关联水平的偏差。
- **其他数据挖掘类型**：包括聚类（clustering）和文本挖掘（text mining）。

### 11.5 总结
- **数据分析系统（Data analytics systems）**：分析事务处理系统收集的在线数据以及其他来源的数据，辅助商业决策。决策支持系统形式多样，包括OLAP系统和数据挖掘系统。
- **数据仓库（Data warehouses）**：收集和归档重要的运营数据，用于决策支持和历史数据分析（如预测趋势） 。数据仓库的一个主要任务常是对输入数据源进行数据清理，其模式多为多维的，涉及一个或多个非常大的事实表和几个小得多的维度表。 
- **在线分析处理（OLAP）工具**：帮助分析师以不同方式查看汇总数据，洞察组织运作情况。
    - 处理多维数据，由维度属性和度量属性表征。
    - 数据立方体（data cube）由以不同方式汇总的多维数据组成，预计算数据立方体可加快对数据汇总的查询。
    - 交叉表（Cross - tab）允许用户同时查看多维数据的两个维度以及数据汇总。
    - 用户可使用钻取（drill down）、上卷（rollup）、切片（slicing）和切块（dicing）等操作。 
- **SQL标准**：为数据分析提供多种操作符，如`cube`、`rollup`和`pivot`操作。
- **数据挖掘（Data mining）**：是半自动分析大型数据库以寻找有用模式的过程，应用包括基于过去示例预测值、寻找购买之间的关联以及自动聚类人员和电影等。
>日期：5.3  

课后习题选做  
### 11.7
在支持数据仓库的数据库系统中，列存储潜在优势如下：
- **数据压缩**：同一列的数据通常具有相似性，例如数值列可能大部分是相近范围的数字，文本列可能有重复的词汇等。基于这种数据特征，列存储可以使用更高效的压缩算法，大幅减少数据存储空间。例如行程长度列，可能大部分数值在一定范围内，使用游程编码等压缩算法能有效压缩数据。
- **查询性能提升**：在数据仓库场景中，很多查询是针对特定列进行聚合、过滤等操作。列存储可以只读取查询涉及的列，而无需像行存储那样读取整行数据，减少了I/O量。例如统计销售数据中各地区的总销售额，只需读取“地区”和“销售额”列，列存储能快速定位并读取这两列数据，加快查询速度。 
- **向量处理**：列存储的数据布局更适合现代CPU的向量处理指令集。可以将一列数据作为一个向量进行批量处理，提高CPU处理效率，加速数据分析操作。

### 11.8
假设`takes`和`teaches`关系表为事实表，且都有一个值恒为1的`reg_count`度量属性。
- **对于`takes`关系表**：
    - **维度属性和维度表**：维度属性可能包括学生相关属性（如学生ID、姓名、年级等 ）、课程相关属性（如课程ID、课程名称、学分等 ）、学期相关属性（如学期ID、学期名称、年份等 ） 。会对应生成学生维度表、课程维度表、学期维度表等。
    - **模式类型**：这种结构符合星型模式（star schema）特征，事实表`takes`通过外键与多个维度表相连，各维度表之间没有直接关联。 
- **对于`teaches`关系表**：
    - **维度属性和维度表**：维度属性可能有教师相关属性（如教师ID、姓名、职称等 ）、课程相关属性（同`takes`表中的课程属性 ）、学期相关属性（同`takes`表中的学期属性 ） 。会对应生成教师维度表、课程维度表、学期维度表等。
    - **模式类型**：同样是星型模式，事实表`teaches`通过外键与各维度表相连 。如果维度表之间存在进一步的规范化，例如课程维度表中的学科分类又拆分出单独的维度表，就可能形成雪花模式（snowflake schema） ，但仅基于题目给定条件，默认是星型模式。 

### 11.9
- **a.**
分析师应从总销售额这个聚合开始，即每月所有销售元组价格值的总和。相关的下钻（drill - down）操作包括：
    - 按商品类别下钻，查看每个商品类别的销售额变化，以确定是否有特定商品类别导致销售下降。
    - 按商店下钻，分析各个商店的销售情况，判断是否是某些商店的销售减少引起整体下降。 
    - 按客户国家下钻，了解不同国家客户的购买变化，看是否存在某个国家客户购买量大幅下降的情况。 
- **b.**
假设星型模式中有`sales`事实表，包含`item_category`（商品类别）、`store`（商店）、`customer_country`（客户国家）、`price`（价格）等列 ，以下是SQL查询示例（以MySQL为例）：
```sql
SELECT item_category, 
       SUM(price) AS total_sales,
       -- 假设存在记录不同时间的列，这里用sale_date举例
       -- 计算与上一时期相比的销售变化量，这里简单假设上一时期为前一个月
       (SUM(price) - 
        (SELECT SUM(price) 
         FROM sales 
         WHERE MONTH(sale_date) = MONTH(CURRENT_DATE - INTERVAL 1 MONTH) 
           AND YEAR(sale_date) = YEAR(CURRENT_DATE - INTERVAL 1 MONTH)
           AND item_category = s.item_category)) AS sales_decrease
FROM sales s
WHERE YEAR(sale_date) = 2018 AND MONTH(sale_date) = 5
GROUP BY item_category
HAVING sales_decrease < 0
ORDER BY sales_decrease DESC;
```
上述查询先计算每个商品类别的总销售额，再计算与前一个月相比的销售变化量（假设当前时间为2018年5月 ），筛选出销售下降（`sales_decrease < 0` ）的商品类别，并按销售下降幅度从大到小排序。

### 11.10
设总交易数为$N$。已知购买牛仔裤（Jeans）的交易占比为 $\frac{1}{2}$ ，即购买牛仔裤的交易数为 $\frac{N}{2}$ ；购买T恤（T - shirts）的交易占比为 $\frac{1}{3}$  ，即购买T恤的交易数为 $\frac{N}{3}$ ；购买牛仔裤的交易中，有一半也购买T恤，即同时购买牛仔裤和T恤的交易数为 $\frac{1}{2} \times \frac{N}{2}=\frac{N}{4}$  。
- **关联规则1：Jeans ⇒ T - shirts**
    - **支持度（Support）**：支持度是同时满足规则前件和后件的比例，即同时购买牛仔裤和T恤的交易数占总交易数的比例， $Support=\frac{\frac{N}{4}}{N}=\frac{1}{4}$  。
    - **置信度（Confidence）**：置信度是当前件为真时后件为真的频率，购买牛仔裤的交易中购买T恤的比例， $Confidence = \frac{\frac{N}{4}}{\frac{N}{2}}=\frac{1}{2}$  。 
- **关联规则2：T - shirts ⇒ Jeans**
    - **支持度（Support）**：同样是同时购买牛仔裤和T恤的交易数占总交易数的比例， $Support=\frac{\frac{N}{4}}{N}=\frac{1}{4}$  。
    - **置信度（Confidence）**：购买T恤的交易中购买牛仔裤的比例， $Confidence = \frac{\frac{N}{4}}{\frac{N}{3}}=\frac{3}{4}$  。 

### 11.11
一本书中部分、章节、节和子节的组织与聚类相关，原因及聚类形式如下：
- **相关性**：书籍内容的组织是将相关主题的内容聚集在一起。部分包含相关的章节，章节又包含相关的节，节中可能还有子节。这类似于聚类将相似的数据点聚集在一起，在书籍中就是将相似主题的文本内容聚集。例如计算机书籍中，“数据库”相关内容会集中在一个章节，章节下的节可能分别介绍数据库设计、数据库查询等相关主题，这些内容在逻辑上是相关的，如同聚类中相似的数据点被归为一类。 
- **聚类形式**：属于层次聚类（hierarchical clustering） 。从整体的部分开始，逐步细分到章节、节和子节，形成一个层次结构。就像层次聚类先将所有数据点视为一个大簇，然后逐步分裂或合并，形成不同层次的簇结构，书籍内容的组织也是从大的主题范围逐步细分到更具体的主题内容。 

### 11.12
以足球运动为例，预测性挖掘技术可在以下方面应用：
- **球员表现预测**：收集球员的历史比赛数据，包括传球成功率、射门次数、进球数、助攻数、跑动距离、防守拦截次数等属性。使用分类或回归算法，例如决策树分类器可以根据球员在训练中的表现属性，预测其在正式比赛中是否能有出色表现（如分为“优秀”“良好”“一般”等类别 ）；回归算法可以预测球员在未来比赛中的进球数等具体数值。
- **对手分析与比赛结果预测**：收集对手球队的比赛数据，包括阵容、战术风格、球员特点、近期比赛胜负情况等。利用关联规则挖掘找出对手在不同战术下的胜负关联，比如对手在采用某种进攻战术时，其胜率与哪些因素相关。也可以使用聚类算法将对手球队按照风格聚类，分析本球队面对不同风格对手时的比赛结果倾向，从而预测未来比赛的胜负可能性。 
- **伤病预测**：收集球员的身体数据（如心率、体能指标等 ）、比赛负荷数据（如连续比赛场次、上场时间等 ）以及过往伤病记录。通过机器学习算法建立模型，预测球员未来发生伤病的可能性，以便教练组提前调整训练计划和比赛安排，预防伤病发生。 






